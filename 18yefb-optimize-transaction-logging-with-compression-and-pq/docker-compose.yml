services:
  app-before:
    build: .
    environment:
      - NODE_ENV=test
      - REPO=repository_before
    working_dir: /app
    command: sh -c "npm test || echo 'Tests failed as expected for repository_before'"

  app-after:
    build: .
    environment:
      - NODE_ENV=test
      - REPO=repository_after
    working_dir: /app
    command: npm test

  evaluation:
    build: .
    environment:
      - NODE_ENV=test
    working_dir: /app
    volumes:
      - ./evaluation:/app/evaluation
    command: npm run evaluate
