version: '3.8'

services:
  # Run tests (repository_after tests the repository_before code)
  after:
    build: .
    working_dir: /app/repository_after
    command: go test -v ./...
    volumes:
      - ./evaluation/reports:/app/evaluation/reports

  # Run meta tests
  meta:
    build: .
    working_dir: /app/tests
    command: go test -v ./...
    volumes:
      - ./evaluation/reports:/app/evaluation/reports

  # Run full evaluation
  evaluate:
    build: .
    working_dir: /app
    command: go run /app/evaluation/evaluation.go
    volumes:
      - ./evaluation/reports:/app/evaluation/reports