version: '3.8'

services:
  # Run tests that test repository_before code
  before:
    build: .
    working_dir: /app/repository_after
    command: sh -c "go test -v ./... 2>&1; exit 0"
    volumes:
      - ./evaluation/reports:/app/evaluation/reports

  # Run meta tests (test suite verification)
  after:
    build: .
    working_dir: /app/tests
    command: sh -c "go test -v ./... 2>&1; exit 0"
    volumes:
      - ./evaluation/reports:/app/evaluation/reports

  # Run full evaluation
  evaluate:
    build: .
    working_dir: /app
    command: go run /app/evaluation/evaluation.go
    volumes:
      - ./evaluation/reports:/app/evaluation/reports