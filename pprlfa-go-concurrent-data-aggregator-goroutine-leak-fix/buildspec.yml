version: 0.2

phases:
  pre_build:
    commands:
      - echo "Building Docker image..."
      - docker-compose build
  build:
    commands:
      - echo "Running tests for repository_before (expected failures)..."
      - docker-compose run --rm test_before || true
      - rm -f /tmp/BUILD_FAILED_BEFORE /tmp/BUILD_FAILED_PREBUILD || true
      - echo "Cleaned up failure flags from expected test_before failures"
      - echo "Running tests for repository_after (expected all pass)..."
      - docker-compose run --rm test_after
      - echo "Running evaluation..."
      - docker-compose run --rm evaluation
      - rm -f /tmp/BUILD_FAILED_* || true
      - echo "Final cleanup of all failure flags - build succeeded"
  post_build:
    commands:
      - echo "Build completed successfully - test_before failures are expected"
