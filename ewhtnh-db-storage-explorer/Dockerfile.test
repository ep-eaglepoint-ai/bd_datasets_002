FROM node:18-alpine

# Install Python for evaluation
RUN apk add --no-cache python3 py3-pip

# Install dependencies
WORKDIR /app
COPY repository_after/package*.json ./
RUN npm install

# Install uuid and ts-node for evaluation script
RUN npm install uuid @types/uuid ts-node typescript

# Set up Python
RUN pip3 install --no-cache-dir --break-system-packages pytest

# Copy source code
COPY repository_after/ .

# Install test dependencies
RUN npm install --no-dev

# Copy evaluation script
COPY evaluation/evaluation.ts /app/evaluation/

CMD ["npm", "test"]
