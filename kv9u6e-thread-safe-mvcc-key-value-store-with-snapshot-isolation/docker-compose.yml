services:
  app-before:
    build: .
    command: echo "No implementation in repository_before - skipping tests"
    volumes:
      - .:/app

  app-after:
    build: .
    working_dir: /app
    command: ["sh", "-c", "pytest -q tests | python -c \"import re,sys; text=sys.stdin.read(); m=re.search(r'(\\d+) passed', text); passed=int(m.group(1)) if m else 0; print(); print('Test Suites: 1 total'); print(f'Tests:       {passed} passed, {passed} total'); print('Snapshots:   0 total')\""]
    volumes:
      - .:/app

  evaluation:
    build: .
    working_dir: /app
    command: python evaluation/evaluation.py
    volumes:
      - .:/app
