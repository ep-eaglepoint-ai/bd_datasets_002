diff -ruN repository_before/balancer.go repository_after/balancer.go
--- repository_before/balancer.go	2026-01-28 11:00:52.030951601 +0300
+++ repository_after/balancer.go	2026-01-28 23:03:05.216832048 +0300
@@ -1,6 +1,4 @@
-// // filename: balancer.go
-
-package routing
+package repository
 
 import (
 	"sync"
@@ -20,7 +18,7 @@
 	currentWeight int
 	maxWeight     int
 	gcdWeight     int
-	mu            sync.RWMutex // Protects the nodes slice and internal state
+	mu            sync.RWMutex
 }
 
 // NewDynamicWeightedBalancer initializes the balancer for a given set of nodes.
@@ -33,7 +31,7 @@
 	return b
 }
 
-// recalculateGains updates internal GCD and MaxWeight parameters based on current node set.
+// recalculateGains updates internal GCD and MaxWeight parameters.
 func (b *DynamicWeightedBalancer) recalculateGains() {
 	maxW := 0
 	g := 0
@@ -43,12 +41,13 @@
 		}
 		if g == 0 {
 			g = n.Weight
-		} else {
+		} else if n.Weight > 0 {
 			g = gcd(g, n.Weight)
 		}
 	}
 	b.maxWeight = maxW
 	b.gcdWeight = g
+	// FIX: Handle zero GCD
 	if b.gcdWeight == 0 {
 		b.gcdWeight = 1
 	}
@@ -67,8 +66,10 @@
 	defer b.mu.Unlock()
 	b.nodes = newNodes
 	b.recalculateGains()
-	// Note: currentIndex and currentWeight are intentionally NOT reset to 0
-	// to attempt to preserve the current position in the round-robin cycle.
+	// FIX: Ensure currentIndex is within bounds after slice reduction
+	if len(b.nodes) > 0 && b.currentIndex >= len(b.nodes) {
+		b.currentIndex = b.currentIndex % len(b.nodes)
+	}
 }
 
 // GetNextNode selects the next node using Interleaved Weighted Round Robin logic.
@@ -81,6 +82,11 @@
 		return ""
 	}
 
+	// FIX: Handle case where all weights are zero
+	if b.maxWeight == 0 {
+		return ""
+	}
+
 	for i := 0; i < n*b.maxWeight; i++ {
 		b.currentIndex = (b.currentIndex + 1) % n
 		if b.currentIndex == 0 {
@@ -100,3 +106,10 @@
 	}
 	return ""
 }
+
+// GetCurrentState returns internal state for testing purposes
+func (b *DynamicWeightedBalancer) GetCurrentState() (int, int, int, int) {
+	b.mu.RLock()
+	defer b.mu.RUnlock()
+	return b.currentIndex, b.currentWeight, b.maxWeight, b.gcdWeight
+}
\ No newline at end of file
diff -ruN repository_before/go.mod repository_after/go.mod
--- repository_before/go.mod	1970-01-01 03:00:00.000000000 +0300
+++ repository_after/go.mod	2026-01-28 12:19:22.582206388 +0300
@@ -0,0 +1,3 @@
+module repository
+
+go 1.21
\ No newline at end of file
