services:
  app:
    build: .
    entrypoint:
      - sh
      - -lc
      - |
        if [ ! -d node_modules ] || [ -z "$(ls -A node_modules 2>/dev/null)" ]; then
          npm ci --silent
        fi
        exec "$@"
      - --
    command: npm test
    volumes:
      - .:/app
      - node_modules:/app/node_modules

volumes:
  node_modules:
